# å®žéªŒæŠ¥å‘Š

---

## ç›®å½•
1. [å®žéªŒç›®çš„](#1-å®žéªŒç›®çš„)
2. [å®žéªŒæµç¨‹](#2-å®žéªŒæµç¨‹)
3. [ä»£ç é€»è¾‘](#3-ä»£ç é€»è¾‘)
4. [ä»£ç æ¨¡å—ä¸Žå®žçŽ°](#4-ä»£ç æ¨¡å—ä¸Žå®žçŽ°)
5. [å®žéªŒç»“æžœä¸Žè§£è¯»](#5-å®žéªŒç»“æžœä¸Žè§£è¯»)
6. [æ€»ç»“ä¸Žç»“è®º](#6-æ€»ç»“ä¸Žç»“è®º)

---

## 1. å®žéªŒç›®çš„

### 1.1 ç ”ç©¶èƒŒæ™¯

åœ¨äº¿çº§è§„æ¨¡çš„æŽ¨èç³»ç»Ÿä¸­ï¼Œé¢„æµ‹ç‚¹å‡»çŽ‡ï¼ˆCTRï¼‰ä¸€ç›´æ˜¯å›¾ç¥žç»ç½‘ç»œï¼ˆGNNï¼‰é¢ä¸´çš„æŒ‘æˆ˜æ€§ä»»åŠ¡ã€‚ä¸»è¦åŽŸå› åœ¨äºŽèšåˆæ•°åäº¿é‚»å±…èŠ‚ç‚¹æ‰€å¸¦æ¥çš„å·¨å¤§è®¡ç®—å¤æ‚åº¦ã€‚ä¼ ç»Ÿçš„ GNN-based CTR æ¨¡åž‹é€šå¸¸é‡‡ç”¨**é‡‡æ ·**ç­–ç•¥ï¼Œä»Žæ•°åäº¿é‚»å±…ä¸­éšæœºæŠ½å–å‡ ç™¾ä¸ªæ¥å®žçŽ°é«˜æ•ˆåœ¨çº¿æŽ¨èã€‚ç„¶è€Œï¼Œè¿™ç§æ–¹æ³•å¼•å…¥äº†ä¸¥é‡çš„**é‡‡æ ·åå·®**ï¼Œå¯¼è‡´æ— æ³•æ•èŽ·ç”¨æˆ·æˆ–ç‰©å“çš„å®Œæ•´è¡Œä¸ºæ¨¡å¼ã€‚

### 1.2 MacGNN æ ¸å¿ƒåˆ›æ–°

MacGNN æå‡ºäº†åˆ›æ–°æ€§çš„è§£å†³æ–¹æ¡ˆï¼š

| æ¦‚å¿µ | æè¿° |
|------|------|
| **å¾®è§‚æŽ¨èå›¾ (Micro Graph)** | ä¼ ç»Ÿçš„ç”¨æˆ·-ç‰©å“äº¤äº’å›¾ï¼ŒèŠ‚ç‚¹æ•°é‡å¯è¾¾æ•°åäº¿çº§åˆ« |
| **å®è§‚æŽ¨èå›¾ (MAG)** | å°†å…·æœ‰ç›¸ä¼¼è¡Œä¸ºæ¨¡å¼çš„å¾®è§‚èŠ‚ç‚¹èšåˆæˆå®è§‚èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹æ•°é‡ä»Žæ•°åäº¿é™è‡³æ•°ç™¾ |
| **å®è§‚å›¾ç¥žç»ç½‘ç»œ (MacGNN)** | åœ¨å®è§‚å±‚é¢èšåˆä¿¡æ¯ï¼Œç²¾ç»†åŒ–å®è§‚é‚»å±…çš„åµŒå…¥è¡¨ç¤º |

### 1.3 å®žéªŒç›®æ ‡

æœ¬å®žéªŒçš„ç›®æ ‡åŒ…æ‹¬ï¼š

1. **éªŒè¯ MacGNN æœ‰æ•ˆæ€§**: åœ¨å¤šä¸ªçœŸå®žæ•°æ®é›†ä¸Šå¯¹æ¯” MacGNN ä¸ŽåŸºçº¿æ¨¡åž‹çš„æ€§èƒ½
2. **æ¶ˆèžå®žéªŒ**: éªŒè¯å®è§‚å›¾ç»„ä»¶å¯¹æ¨¡åž‹æ€§èƒ½çš„è´¡çŒ®
3. **ç”¨æˆ·åˆ†ç»„åˆ†æž**: è¯„ä¼°æ¨¡åž‹åœ¨ä¸åŒæ´»è·ƒåº¦ç”¨æˆ·ç¾¤ä½“ä¸Šçš„è¡¨çŽ°
4. **æŽ¨ç†æ•ˆçŽ‡è¯„ä¼°**: æµ‹é‡æ¨¡åž‹çš„æŽ¨ç†æ—¶é—´ï¼ŒéªŒè¯å·¥ä¸šéƒ¨ç½²å¯è¡Œæ€§
5. **è¶…å‚æ•°è°ƒä¼˜**: æŽ¢ç´¢ä¸åŒè¶…å‚æ•°é…ç½®å¯¹æ¨¡åž‹æ€§èƒ½çš„å½±å“

---

## 2. å®žéªŒæµç¨‹

### 2.1 æ•´ä½“å®žéªŒæµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           MacGNN å®žéªŒæµç¨‹                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  æ•°æ®åŠ è½½     â”‚â”€â”€â”€â–¶â”‚  æ¨¡åž‹åˆå§‹åŒ–   â”‚â”€â”€â”€â–¶â”‚  è®­ç»ƒå¾ªçŽ¯     â”‚              â”‚
â”‚  â”‚  Data Load   â”‚    â”‚  Model Init  â”‚    â”‚  Training    â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚         â”‚                   â”‚                   â”‚                       â”‚
â”‚         â–¼                   â–¼                   â–¼                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ ç‰¹å¾æå–      â”‚    â”‚ åµŒå…¥å±‚åˆå§‹åŒ–  â”‚    â”‚ æ—©åœæœºåˆ¶      â”‚              â”‚
â”‚  â”‚ - User ID    â”‚    â”‚ - User Embed â”‚    â”‚ EarlyStopper â”‚              â”‚
â”‚  â”‚ - Item ID    â”‚    â”‚ - Item Embed â”‚    â”‚              â”‚              â”‚
â”‚  â”‚ - å®è§‚é‚»å±…    â”‚    â”‚ - Macro Embedâ”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚  â”‚ - åŽ†å²åºåˆ—    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â–¼                       â”‚
â”‚                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚                                          â”‚  æ¨¡åž‹è¯„ä¼°     â”‚              â”‚
â”‚                                          â”‚ - AUC        â”‚              â”‚
â”‚                                          â”‚ - LogLoss    â”‚              â”‚
â”‚                                          â”‚ - GAUC       â”‚              â”‚
â”‚                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ•°æ®é›†

å®žéªŒä½¿ç”¨ä¸‰ä¸ªå…¬å¼€æ•°æ®é›†ï¼š

| æ•°æ®é›† | æ¥æº | æè¿° |
|--------|------|------|
| **MovieLens-10M** (ml-10m) | GroupLens | ç”µå½±è¯„åˆ†æ•°æ®ï¼ŒåŒ…å«çº¦1000ä¸‡æ¡è¯„åˆ†è®°å½• |
| **Electronics** (elec) | Amazon Reviews | ç”µå­äº§å“è¯„è®ºæ•°æ® |
| **KuaiRec** (kuairec) | å¿«æ‰‹ | çŸ­è§†é¢‘æŽ¨èæ•°æ® |

### 2.3 è¯„ä¼°æŒ‡æ ‡

| æŒ‡æ ‡ | å…¨ç§° | æè¿° |
|------|------|------|
| **AUC** | Area Under ROC Curve | è¡¡é‡æ¨¡åž‹æ•´ä½“æŽ’åºèƒ½åŠ›ï¼Œå€¼è¶Šé«˜è¶Šå¥½ |
| **LogLoss** | Logarithmic Loss | è¡¡é‡é¢„æµ‹æ¦‚çŽ‡ä¸ŽçœŸå®žæ ‡ç­¾çš„äº¤å‰ç†µæŸå¤±ï¼Œå€¼è¶Šä½Žè¶Šå¥½ |
| **GAUC** | Group AUC | æŒ‰ç”¨æˆ·åˆ†ç»„è®¡ç®— AUC åŽåŠ æƒå¹³å‡ï¼Œæ›´ç¬¦åˆä¸ªæ€§åŒ–æŽ¨èåœºæ™¯ |

### 2.4 å¯¹æ¯”åŸºçº¿æ¨¡åž‹

| æ¨¡åž‹ | è®ºæ–‡ | ç‰¹ç‚¹ |
|------|------|------|
| **DeepFM** | WWW 2017 | ç»“åˆ FM çš„äºŒé˜¶ç‰¹å¾äº¤å‰ä¸Ž DNN çš„é«˜é˜¶ç‰¹å¾äº¤å‰ |
| **DIN** | KDD 2018 | ä½¿ç”¨æ³¨æ„åŠ›æœºåˆ¶æ•èŽ·ç”¨æˆ·å…´è¶£ |
| **DIEN** | AAAI 2019 | å¼•å…¥ GRU å»ºæ¨¡ç”¨æˆ·å…´è¶£æ¼”åŒ–è¿‡ç¨‹ |
| **MacGNN** | WWW 2024 | æœ¬æ–‡æå‡ºçš„å®è§‚å›¾ç¥žç»ç½‘ç»œ |

---

## 3. ä»£ç é€»è¾‘

### 3.1 æ•°æ®æµå‘å›¾

```
è¾“å…¥æ•°æ® x (batch_size Ã— feature_dim)
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ç‰¹å¾è§£æž                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  user_id  â”‚  user_1ord_neighbor  â”‚  user_2ord_neighbor  â”‚  user_recent â”‚
â”‚  item_id  â”‚  item_1ord_neighbor  â”‚  item_2ord_neighbor  â”‚  item_recent â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          åµŒå…¥å±‚å¤„ç†                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  user_embed     â”‚  user_1ord_embed (å®è§‚)  â”‚  user_recent_embed      â”‚
â”‚  item_embed     â”‚  item_1ord_embed (å®è§‚)  â”‚  item_recent_embed      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ³¨æ„åŠ›é‚»å±…èšåˆ                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Query-Key-Value Attention Mechanism                                 â”‚
â”‚  score = softmax(Q Ã— K^T / âˆšd)                                      â”‚
â”‚  output = score Ã— V                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      åŠ æƒæ±‚å’Œä¸Žæ‹¼æŽ¥                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  concat = [user_emb, user_1ord_ws, user_2ord_ws, user_recent_ws,    â”‚
â”‚            item_emb, item_1ord_ws, item_2ord_ws, item_recent_ws]    â”‚
â”‚                        (14 Ã— embed_dim)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          MLP + Sigmoid                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Linear(14*embed_dim, 200) â†’ Dice â†’ Linear(200, 80) â†’ Dice â†’        â”‚
â”‚  Linear(80, 1) â†’ Sigmoid                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
        è¾“å‡º: CTR é¢„æµ‹æ¦‚çŽ‡ (0~1)
```

### 3.2 æ ¸å¿ƒç®—æ³•æµç¨‹

```python
# ä¼ªä»£ç : MacGNN å‰å‘ä¼ æ’­
def forward(x):
    # Step 1: æå–ç”¨æˆ·/ç‰©å“å¾®è§‚åµŒå…¥
    user_emb = user_embed(x[:, 0])
    item_emb = item_embed(x[:, item_pos])
    
    # Step 2: æå–å®è§‚é‚»å±…ä¿¡æ¯
    user_1ord_neighbor = x[:, 1:i_group_num+1]           # ç”¨æˆ·ä¸€é˜¶é‚»å±… (ç‰©å“ç°‡)
    user_2ord_neighbor = x[:, ...]                        # ç”¨æˆ·äºŒé˜¶é‚»å±… (ç”¨æˆ·ç°‡)
    
    # Step 3: è®¡ç®—å®è§‚æƒé‡ (æ¸©åº¦ç³»æ•° Ï„ æŽ§åˆ¶å¹³æ»‘ç¨‹åº¦)
    user_1ord_weight = softmax(log(neighbor_count + 1) / Ï„)
    
    # Step 4: å®è§‚é‚»å±…åµŒå…¥èšåˆ
    user_1ord_embed = i_macro_embed(i_group_slice)        # ç‰©å“å®è§‚åµŒå…¥
    u_1ord_trans = attention_aggregate(user_1ord_embed, item_emb)
    
    # Step 5: åŠ æƒæ±‚å’Œ
    user_1ord_ws = (u_1ord_trans * user_1ord_weight).sum(dim=1)
    
    # Step 6: ç‰¹å¾æ‹¼æŽ¥ä¸Ž MLP é¢„æµ‹
    concat = torch.cat([user_emb, user_1ord_ws, ..., item_emb, ...])
    output = sigmoid(mlp(concat))
    
    return output
```

### 3.3 å®è§‚æƒé‡è®¡ç®—å…¬å¼

æ¸©åº¦ç³»æ•° Ï„ æŽ§åˆ¶å®è§‚é‚»å±…æƒé‡çš„å¹³æ»‘ç¨‹åº¦ï¼š

$$
w_i = \frac{\exp(\log(n_i + 1) / \tau)}{\sum_j \exp(\log(n_j + 1) / \tau)}
$$

å…¶ä¸­ï¼š
- $n_i$ æ˜¯ç¬¬ $i$ ä¸ªå®è§‚é‚»å±…çš„äº¤äº’æ¬¡æ•°
- $\tau$ æ˜¯æ¸©åº¦ç³»æ•°ï¼Œå€¼è¶Šå°åˆ†å¸ƒè¶Šå°–é”

---

## 4. ä»£ç æ¨¡å—ä¸Žå®žçŽ°

### 4.1 æ¨¡å—æž¶æž„å›¾

```
MacGNN_demo.ipynb
â”œâ”€â”€ ðŸ“¦ ä¾èµ–å¯¼å…¥æ¨¡å—
â”‚   â”œâ”€â”€ torch, numpy, pandas
â”‚   â””â”€â”€ sklearn.metrics
â”‚
â”œâ”€â”€ ðŸ“Š è¯„ä¼°æŒ‡æ ‡æ¨¡å—
â”‚   â”œâ”€â”€ cal_group_auc()         # GAUC è®¡ç®—
â”‚   â””â”€â”€ evaluation()            # AUC/LogLoss/GAUC
â”‚
â”œâ”€â”€ ðŸ§  æ¿€æ´»å‡½æ•°æ¨¡å—
â”‚   â””â”€â”€ Dice                    # è‡ªé€‚åº”æ¿€æ´»å‡½æ•°
â”‚
â”œâ”€â”€ ðŸ“ˆ åŸºçº¿æ¨¡åž‹æ¨¡å—
â”‚   â”œâ”€â”€ DeepFM                  # FM + DNN
â”‚   â”œâ”€â”€ DIN                     # æ·±åº¦å…´è¶£ç½‘ç»œ
â”‚   â””â”€â”€ DIEN                    # æ·±åº¦å…´è¶£æ¼”åŒ–ç½‘ç»œ
â”‚
â”œâ”€â”€ ðŸ”¥ æ ¸å¿ƒæ¨¡åž‹æ¨¡å—
â”‚   â”œâ”€â”€ NeighborAggregation     # æ³¨æ„åŠ›é‚»å±…èšåˆ
â”‚   â”œâ”€â”€ MacGNN                  # å®Œæ•´ MacGNN
â”‚   â””â”€â”€ MacGNN_NoMacro          # æ¶ˆèžç‰ˆæœ¬ (æ— å®è§‚)
â”‚
â”œâ”€â”€ ðŸ—ƒï¸ æ•°æ®æ¨¡å—
â”‚   â”œâ”€â”€ DatasetBuilder          # PyTorch Dataset
â”‚   â”œâ”€â”€ load_dataset_assets()   # æ•°æ®åŠ è½½
â”‚   â””â”€â”€ build_dataloaders()     # DataLoader æž„å»º
â”‚
â”œâ”€â”€ ðŸŽ¯ è®­ç»ƒæ¨¡å—
â”‚   â”œâ”€â”€ train()                 # å¸¦è°ƒåº¦å™¨çš„è®­ç»ƒå¾ªçŽ¯
â”‚   â”œâ”€â”€ train_simple()          # ç®€åŒ–è®­ç»ƒå¾ªçŽ¯
â”‚   â””â”€â”€ EarlyStopper            # æ—©åœæœºåˆ¶
â”‚
â”œâ”€â”€ ðŸ“Š ç»¼åˆè¯„ä¼°æ¨¡å—
â”‚   â”œâ”€â”€ evaluation_comprehensive()
â”‚   â”œâ”€â”€ analyze_user_groups()   # ç”¨æˆ·åˆ†ç»„åˆ†æž
â”‚   â””â”€â”€ run_model_comparison()  # å¤šæ¨¡åž‹å¯¹æ¯”
â”‚
â””â”€â”€ ðŸ“ˆ å¯è§†åŒ–æ¨¡å—
    â”œâ”€â”€ plot_model_comparison()
    â””â”€â”€ create_comparison_table()
```

### 4.2 æ ¸å¿ƒç±»è¯¦è§£

#### 4.2.1 Dice æ¿€æ´»å‡½æ•°

```python
class Dice(nn.Module):
    """
    Data-aware Adaptive Activation Function
    æ ¹æ®æ•°æ®åˆ†å¸ƒè‡ªé€‚åº”è°ƒæ•´æ¿€æ´»è¡Œä¸º
    """
    def __init__(self):
        super(Dice, self).__init__()
        self.alpha = nn.Parameter(torch.zeros((1,)))  # å¯å­¦ä¹ å‚æ•°
        
    def forward(self, x):
        # è®¡ç®—æ‰¹æ¬¡ç»Ÿè®¡é‡
        avg = x.mean(dim=0)
        std = x.std(dim=0)
        norm_x = (x - avg) / (std + 1e-8)
        
        # è‡ªé€‚åº”é—¨æŽ§
        p = torch.sigmoid(norm_x)
        return x.mul(p) + self.alpha * x.mul(1 - p)
```

**è®¾è®¡æ€æƒ³**ï¼š
- Dice æ ¹æ®è¾“å…¥æ•°æ®çš„åˆ†å¸ƒè‡ªé€‚åº”è°ƒæ•´æ¿€æ´»ç¨‹åº¦
- å‚æ•° Î± å…è®¸æ¨¡åž‹å­¦ä¹ åœ¨æ­£è´Ÿæ¿€æ´»ä¹‹é—´çš„æƒè¡¡
- ç›¸æ¯” PReLU/LeakyReLUï¼ŒDice æ›´é€‚åˆ CTR é¢„æµ‹ä»»åŠ¡

#### 4.2.2 NeighborAggregation æ³¨æ„åŠ›èšåˆ

```python
class NeighborAggregation(nn.Module):
    """
    åŸºäºŽ Query-Key-Value çš„æ³¨æ„åŠ›é‚»å±…èšåˆæœºåˆ¶
    """
    def __init__(self, embed_dim=8, hidden_dim=8):
        super().__init__()
        self.Q_w = nn.Linear(embed_dim, hidden_dim, bias=False)
        self.K_w = nn.Linear(embed_dim, hidden_dim, bias=False)
        self.V_w = nn.Linear(embed_dim, hidden_dim, bias=False)
        self.trans_d = math.sqrt(hidden_dim)
        
    def forward(self, query, key):
        trans_Q = self.Q_w(query)           # é‚»å±…åµŒå…¥æŠ•å½±
        trans_K = self.K_w(key)             # ç›®æ ‡èŠ‚ç‚¹æŠ•å½±
        trans_V = self.V_w(query)           # å€¼æŠ•å½±
        
        # ç¼©æ”¾ç‚¹ç§¯æ³¨æ„åŠ›
        score = softmax(bmm(trans_Q, trans_K.T) / âˆšd)
        answer = mul(trans_V, score)
        return answer
```

**å…³é”®è®¾è®¡**ï¼š
- ä½¿ç”¨ Scaled Dot-Product Attention
- Query æ¥è‡ªé‚»å±…åµŒå…¥ï¼ŒKey æ¥è‡ªç›®æ ‡èŠ‚ç‚¹
- é™¤ä»¥ âˆšd é˜²æ­¢ softmax æ¢¯åº¦æ¶ˆå¤±

#### 4.2.3 MacGNN å®Œæ•´æ¨¡åž‹

```python
class MacGNN(nn.Module):
    """
    Micro-macro Consumer Graph Neural Network
    """
    def __init__(self, field_dims, u_group_num, i_group_num, 
                 embed_dim, recent_len, tau=0.8, device='cpu'):
        # å¾®è§‚åµŒå…¥å±‚
        self.user_embed = nn.Embedding(field_dims[0], embed_dim)
        self.item_embed = nn.Embedding(field_dims[1], embed_dim)
        
        # å®è§‚åµŒå…¥å±‚ (å…³é”®åˆ›æ–°)
        self.u_macro_embed = nn.Embedding(u_group_num + 1, embed_dim)
        self.i_macro_embed = nn.Embedding(i_group_num + 1, embed_dim)
        
        # æ³¨æ„åŠ›èšåˆå™¨
        self.u_shared_aggregator = NeighborAggregation(embed_dim, 2*embed_dim)
        self.i_shared_aggregator = NeighborAggregation(embed_dim, 2*embed_dim)
        
        # æ¸©åº¦ç³»æ•°
        self.tau = tau
        
        # MLP é¢„æµ‹å™¨
        self.mlp = nn.Sequential(
            nn.Linear(embed_dim * 14, 200), Dice(),
            nn.Linear(200, 80), Dice(),
            nn.Linear(80, 1)
        )
```

**æ¨¡åž‹è¾“å…¥ç‰¹å¾ç»“æž„** (å…± 14 Ã— embed_dim)ï¼š

| ç‰¹å¾ç»„ | ç»´åº¦ | æè¿° |
|--------|------|------|
| user_embedding | embed_dim | ç”¨æˆ·å¾®è§‚åµŒå…¥ |
| user_1ord_ws | 2Ã—embed_dim | ç”¨æˆ·ä¸€é˜¶å®è§‚é‚»å±…èšåˆ |
| user_2ord_ws | 2Ã—embed_dim | ç”¨æˆ·äºŒé˜¶å®è§‚é‚»å±…èšåˆ |
| user_recent_ws | 2Ã—embed_dim | ç”¨æˆ·åŽ†å²è¡Œä¸ºèšåˆ |
| item_embedding | embed_dim | ç‰©å“å¾®è§‚åµŒå…¥ |
| item_1ord_ws | 2Ã—embed_dim | ç‰©å“ä¸€é˜¶å®è§‚é‚»å±…èšåˆ |
| item_2ord_ws | 2Ã—embed_dim | ç‰©å“äºŒé˜¶å®è§‚é‚»å±…èšåˆ |
| item_recent_ws | 2Ã—embed_dim | ç‰©å“åŽ†å²äº¤äº’èšåˆ |

#### 4.2.4 æ—©åœæœºåˆ¶

```python
class EarlyStopper:
    """
    é˜²æ­¢è¿‡æ‹Ÿåˆçš„æ—©åœæœºåˆ¶
    å½“éªŒè¯é›† AUC è¿žç»­ num_trials æ¬¡ä¸æå‡æ—¶åœæ­¢è®­ç»ƒ
    """
    def __init__(self, num_trials, save_path):
        self.num_trials = num_trials
        self.trial_counter = 0
        self.best_auc = 0.0
        
    def is_continuable(self, model, auc, log_loss):
        if auc > self.best_auc:
            self.best_auc = auc
            self.trial_counter = 0
            torch.save(model.state_dict(), self.save_path)
            return True
        elif self.trial_counter + 1 < self.num_trials:
            self.trial_counter += 1
            return True
        return False
```

### 4.3 è®­ç»ƒé…ç½®å‚æ•°

```python
config = {
    # æ•°æ®é…ç½®
    'dataset_name': 'elec',         # æ•°æ®é›†: 'ml-10m', 'elec', 'kuairec'
    'data_dir': 'data',
    
    # æ¨¡åž‹é…ç½®
    'model_name': 'macgnn',
    'embed_dim': 32,                 # åµŒå…¥ç»´åº¦
    'recent_len': 20,                # åŽ†å²åºåˆ—é•¿åº¦
    'tau': 0.8,                      # æ¸©åº¦ç³»æ•°
    
    # è®­ç»ƒé…ç½®
    'epoch': 20,
    'batch_size': 1024,
    'learning_rate': 1e-2,
    'weight_decay': 5e-5,
    'early_epoch': 4,                # æ—©åœè€å¿ƒå€¼
    'mlp_dropout': 0.0,
    
    # å­¦ä¹ çŽ‡è°ƒåº¦ (å¯é€‰)
    'lr_scheduler': None,            # 'cosine', 'steplr', None
    
    # ç¡¬ä»¶é…ç½®
    'use_gpu': True,
    'cuda_id': 0,
}
```

### 4.4 è¶…å‚æ•°è°ƒä¼˜åœºæ™¯

å®žéªŒå®šä¹‰äº† 8 ç§è°ƒä¼˜åœºæ™¯ï¼š

| åœºæ™¯å | å­¦ä¹ çŽ‡ | embed_dim | epoch | ç‰¹æ®Šé…ç½® |
|--------|--------|-----------|-------|----------|
| Baseline | 1e-2 | 10 | 20 | åŽŸè®ºæ–‡é…ç½® |
| HighLR_Embed32 | 1e-2 | 32 | 20 | å¢žå¤§åµŒå…¥ç»´åº¦ |
| LowLR_LongEpoch | 1e-3 | 32 | 40 | ä½Žå­¦ä¹ çŽ‡+é•¿è®­ç»ƒ |
| HighLR_Embed32_CosineDrop | 1e-2 | 32 | 25 | Cosineé€€ç«+Dropout |
| LowLR_LongEpoch_Step | 1e-3 | 32 | 60 | StepLRè¡°å‡ |
| ShortSeq_Tau1 | 1e-2 | 32 | 20 | çŸ­åºåˆ—+Ï„=1.0 |
| LongSeq_Tau06 | 1e-2 | 32 | 30 | é•¿åºåˆ—+Ï„=0.6 |
| HighLR_Embed32_MultiRun | 1e-2 | 32 | 20 | 3æ¬¡è¿è¡Œå–å¹³å‡ |

---

## 5. å®žéªŒç»“æžœä¸Žè§£è¯»

### 5.1 å¤šæ¨¡åž‹å¯¹æ¯”å®žéªŒç»“æžœ

#### Electronics æ•°æ®é›† (elec)

| Model | AUC | LogLoss | GAUC | Time (ms) |
|-------|-----|---------|------|-----------|
| **MACGNN** | **0.837595** | **0.503814** | **0.83804** | 0.0326 |
| DIN | 0.694576 | 0.611843 | 0.69100 | 0.0029 |
| DIEN | 0.694131 | 0.613782 | 0.69203 | 0.0127 |
| DEEPFM | 0.691888 | 0.611605 | 0.69069 | 0.0018 |

**ç»“æžœåˆ†æž**ï¼š
- MacGNN åœ¨ Electronics æ•°æ®é›†ä¸Š **AUC æå‡ 14.3%** (ç›¸æ¯”æœ€ä½³åŸºçº¿)
- MacGNN çš„ GAUC åŒæ ·æ˜¾è‘—é¢†å…ˆï¼Œè¯´æ˜Žåœ¨ä¸ªæ€§åŒ–æŽ’åºä¸Šè¡¨çŽ°ä¼˜å¼‚
- è™½ç„¶æŽ¨ç†æ—¶é—´ç•¥é•¿ï¼Œä½†ä»åœ¨æ¯«ç§’çº§ï¼Œæ»¡è¶³åœ¨çº¿æœåŠ¡éœ€æ±‚

#### KuaiRec æ•°æ®é›† (kuairec)

| Model | AUC | LogLoss | GAUC | Time (ms) |
|-------|-----|---------|------|-----------|
| **MACGNN** | **0.814022** | **0.503371** | **0.77262** | 0.0081 |
| DIEN | 0.772750 | 0.546671 | 0.74922 | 0.0077 |
| DIN | 0.715416 | 0.644510 | 0.70502 | 0.0042 |
| DEEPFM | 0.649816 | 0.639139 | 0.50665 | 0.0017 |

**ç»“æžœåˆ†æž**ï¼š
- MacGNN åœ¨çŸ­è§†é¢‘æŽ¨èåœºæ™¯åŒæ ·è¡¨çŽ°æœ€ä½³
- DIEN ä½œä¸ºåºåˆ—æ¨¡åž‹åœ¨è¯¥åœºæ™¯ä¹Ÿæœ‰ä¸é”™è¡¨çŽ°
- DeepFM çš„ GAUC æŽ¥è¿‘éšæœº (0.5)ï¼Œè¯´æ˜Žçº¯ç‰¹å¾äº¤å‰éš¾ä»¥å»ºæ¨¡ç”¨æˆ·åå¥½

#### MovieLens-10M æ•°æ®é›† (ml-10m)

| Model | AUC | LogLoss | GAUC | Time (ms) |
|-------|-----|---------|------|-----------|
| **MACGNN** | **0.745988** | **0.584745** | **0.72065** | 0.0051 |
| DEEPFM | 0.618282 | 0.679630 | 0.54585 | 0.0023 |
| DIN | 0.615590 | 0.690722 | 0.54609 | 0.0033 |
| DIEN | 0.613406 | 0.680122 | 0.53870 | 0.0142 |

**ç»“æžœåˆ†æž**ï¼š
- ç”µå½±æŽ¨èåœºæ™¯ä¸­ï¼ŒMacGNN ä¼˜åŠ¿æ›´åŠ æ˜Žæ˜¾ (AUC æå‡ 12.8%)
- åŸºçº¿æ¨¡åž‹åœ¨è¯¥æ•°æ®é›†è¡¨çŽ°æŽ¥è¿‘ï¼Œè¯´æ˜Žä¼ ç»Ÿæ–¹æ³•éš¾ä»¥æ•èŽ·ç”¨æˆ·ç”µå½±åå¥½
- MacGNN é€šè¿‡å®è§‚å›¾æœ‰æ•ˆèšåˆäº†ç›¸ä¼¼ç”¨æˆ·çš„è¡Œä¸ºæ¨¡å¼

### 5.2 ç»¼åˆæ€§èƒ½å¯¹æ¯”å›¾

![æ¨¡åž‹å¯¹æ¯”](checkpoints/comparison_elec.png)

### 5.3 ç”¨æˆ·åˆ†ç»„æ€§èƒ½åˆ†æž

å®žéªŒå°†ç”¨æˆ·æŒ‰æ´»è·ƒåº¦åˆ†ä¸ºä¸‰ç»„è¿›è¡Œåˆ†æžï¼š

| ç”¨æˆ·ç»„ | å®šä¹‰ | MacGNN | åŸºçº¿æœ€ä½³ |
|--------|------|--------|----------|
| Cold Start (å†·å¯åŠ¨) | äº¤äº’æ•°æœ€å°‘çš„ 1/3 ç”¨æˆ· | âœ… æœ‰æ•ˆ | âŒ è¾ƒå·® |
| Medium Activity | ä¸­ç­‰æ´»è·ƒåº¦ç”¨æˆ· | âœ… è¡¨çŽ°è‰¯å¥½ | ä¸€èˆ¬ |
| High Activity (é«˜æ´»è·ƒ) | äº¤äº’æ•°æœ€å¤šçš„ 1/3 ç”¨æˆ· | âœ… æœ€ä½³ | å°šå¯ |

**å…³é”®å‘çŽ°**ï¼š
- MacGNN åœ¨**å†·å¯åŠ¨ç”¨æˆ·**ä¸Šçš„ä¼˜åŠ¿å°¤ä¸ºæ˜Žæ˜¾
- è¿™å¾—ç›ŠäºŽå®è§‚å›¾èƒ½å¤Ÿå€ŸåŠ©ç›¸ä¼¼ç”¨æˆ·ç¾¤ä½“çš„è¡Œä¸ºæ¥å¼¥è¡¥ä¸ªä½“æ•°æ®ç¨€ç–çš„é—®é¢˜

### 5.4 æ¶ˆèžå®žéªŒç»“æžœ

| æ¨¡åž‹å˜ä½“ | AUC | ç›¸å¯¹åŸºçº¿å˜åŒ– |
|----------|-----|-------------|
| MacGNN (Full) | 0.8376 | - |
| MacGNN w/o Macro | 0.7812 | -6.7% |

**ç»“è®º**ï¼š
- ç§»é™¤å®è§‚å›¾ç»„ä»¶åŽï¼ŒAUC ä¸‹é™çº¦ **6.7%**
- éªŒè¯äº†å®è§‚å›¾åµŒå…¥å¯¹æ¨¡åž‹æ€§èƒ½çš„é‡è¦è´¡çŒ®
- å®è§‚é‚»å±…èšåˆæœºåˆ¶æ˜¯ MacGNN æˆåŠŸçš„å…³é”®

### 5.5 æŽ¨ç†æ•ˆçŽ‡åˆ†æž

| æ¨¡åž‹ | æŽ¨ç†æ—¶é—´ (ms/sample) | ç›¸å¯¹ DeepFM |
|------|---------------------|-------------|
| DeepFM | 0.0018 | 1.0x |
| DIN | 0.0029 | 1.6x |
| DIEN | 0.0127 | 7.1x |
| MacGNN | 0.0326 | 18.1x |

**åˆ†æž**ï¼š
- MacGNN æŽ¨ç†æ—¶é—´è™½ç„¶æœ€é•¿ï¼Œä½†ä»åœ¨ **æ¯«ç§’çº§**
- å¯¹äºŽåœ¨çº¿æŽ¨èç³»ç»Ÿï¼Œ0.03ms çš„å»¶è¿Ÿå®Œå…¨å¯æŽ¥å—
- ç›¸æ¯”ä¼ ç»Ÿ GNN éœ€è¦é‡‡æ ·æ•°ç™¾é‚»å±…ï¼ŒMacGNN åªéœ€èšåˆæ•°åä¸ªå®è§‚èŠ‚ç‚¹ï¼Œæ•ˆçŽ‡å¤§å¹…æå‡

### 5.6 è¶…å‚æ•°æ•æ„Ÿæ€§åˆ†æž

åŸºäºŽ 8 ç§è°ƒä¼˜åœºæ™¯çš„å®žéªŒï¼š

| åœºæ™¯ | AUC | å…³é”®å‘çŽ° |
|------|-----|----------|
| Baseline (embed=10) | 0.8407 | åŽŸè®ºæ–‡é…ç½®ï¼Œè¡¨çŽ°ç¨³å®š |
| HighLR_Embed32 | 0.8376 | å¢žå¤§åµŒå…¥ç»´åº¦ï¼Œæ•ˆæžœç›¸è¿‘ |
| LowLR_LongEpoch | 0.8312 | ä½Žå­¦ä¹ çŽ‡éœ€è¦æ›´é•¿è®­ç»ƒæ—¶é—´ |
| Cosine + Dropout | 0.8298 | æ­£åˆ™åŒ–è¿‡å¼ºå¯èƒ½æ¬ æ‹Ÿåˆ |
| ShortSeq_Tau1 | 0.8356 | çŸ­åºåˆ—å¯¹ç¨€ç–æ•°æ®æ›´å‹å¥½ |
| LongSeq_Tau06 | 0.8289 | é•¿åºåˆ—å¼•å…¥æ›´å¤šå™ªå£° |

**è°ƒä¼˜å»ºè®®**ï¼š
1. **å­¦ä¹ çŽ‡**: 1e-2 æ˜¯åˆé€‚çš„èµ·ç‚¹
2. **åµŒå…¥ç»´åº¦**: 10-32 å‡å¯ï¼Œæ— éœ€è¿‡å¤§
3. **æ¸©åº¦ç³»æ•° Ï„**: 0.6-1.0 èŒƒå›´å†…è°ƒä¼˜
4. **åºåˆ—é•¿åº¦**: æ ¹æ®æ•°æ®ç¨€ç–ç¨‹åº¦è°ƒæ•´ï¼Œç¨€ç–æ•°æ®ç”¨çŸ­åºåˆ—

---

## 6. æ€»ç»“ä¸Žç»“è®º

### 6.1 ä¸»è¦å‘çŽ°

1. **MacGNN æ˜¾è‘—ä¼˜äºŽåŸºçº¿æ¨¡åž‹**
   - åœ¨ä¸‰ä¸ªæ•°æ®é›†ä¸Šï¼ŒMacGNN çš„ AUC å¹³å‡æå‡ **10%+**
   - GAUC æŒ‡æ ‡åŒæ ·é¢†å…ˆï¼Œè¯æ˜Žä¸ªæ€§åŒ–æŽ’åºèƒ½åŠ›ä¼˜å¼‚

2. **å®è§‚å›¾æ˜¯å…³é”®åˆ›æ–°**
   - æ¶ˆèžå®žéªŒè¯æ˜Žç§»é™¤å®è§‚å›¾åŽæ€§èƒ½ä¸‹é™ 6.7%
   - å®è§‚å›¾æœ‰æ•ˆè§£å†³äº†äº¿çº§è§„æ¨¡é‚»å±…èšåˆçš„è®¡ç®—ç“¶é¢ˆ

3. **æŽ¨ç†æ•ˆçŽ‡æ»¡è¶³åœ¨çº¿éœ€æ±‚**
   - æ¯«ç§’çº§æŽ¨ç†å»¶è¿Ÿï¼Œæ”¯æŒåœ¨çº¿å®žæ—¶æŽ¨è
   - ç›¸æ¯”ä¼ ç»Ÿ GNN é‡‡æ ·æ–¹æ³•ï¼Œè®¡ç®—å¤æ‚åº¦å¤§å¹…é™ä½Ž

4. **å†·å¯åŠ¨ä¼˜åŠ¿æ˜Žæ˜¾**
   - å®è§‚å›¾èƒ½å¤Ÿå€ŸåŠ©ç¾¤ä½“è¡Œä¸ºå¼¥è¡¥ä¸ªä½“æ•°æ®ç¨€ç–
   - å¯¹æ–°ç”¨æˆ·/æ–°ç‰©å“çš„æŽ¨èæ•ˆæžœæ˜¾è‘—æå‡

### 6.2 æ–¹æ³•åˆ›æ–°ç‚¹

| åˆ›æ–°ç‚¹ | æè¿° | æ•ˆæžœ |
|--------|------|------|
| å®è§‚æŽ¨èå›¾ (MAG) | å°†èŠ‚ç‚¹ä»Žäº¿çº§åŽ‹ç¼©åˆ°ç™¾çº§ | è§£å†³è®¡ç®—å¤æ‚åº¦ |
| å®è§‚èŠ‚ç‚¹åµŒå…¥ | å­¦ä¹ ç”¨æˆ·/ç‰©å“ç°‡çš„è¡¨ç¤º | æ•èŽ·ç¾¤ä½“è¡Œä¸ºæ¨¡å¼ |
| æ¸©åº¦ç³»æ•° Ï„ | æŽ§åˆ¶å®è§‚æƒé‡åˆ†å¸ƒ | å¹³è¡¡é‚»å±…é‡è¦æ€§ |
| æ³¨æ„åŠ›èšåˆ | QKV æœºåˆ¶ç²¾ç»†åŒ–é‚»å±…è¡¨ç¤º | æå‡è¡¨è¾¾èƒ½åŠ› |

### 6.3 é€‚ç”¨åœºæ™¯

MacGNN ç‰¹åˆ«é€‚åˆä»¥ä¸‹åœºæ™¯ï¼š
- âœ… äº¿çº§ç”¨æˆ·/ç‰©å“çš„å¤§è§„æ¨¡æŽ¨èç³»ç»Ÿ
- âœ… éœ€è¦å®žæ—¶åœ¨çº¿é¢„æµ‹çš„ CTR ä»»åŠ¡
- âœ… å†·å¯åŠ¨é—®é¢˜ä¸¥é‡çš„æŽ¨èåœºæ™¯
- âœ… éœ€è¦å»ºæ¨¡ç”¨æˆ·ç¾¤ä½“è¡Œä¸ºçš„ä¸šåŠ¡

### 6.4 æœªæ¥å·¥ä½œæ–¹å‘

1. **åŠ¨æ€å®è§‚å›¾**: æ ¹æ®å®žæ—¶äº¤äº’åŠ¨æ€æ›´æ–°å®è§‚èŠ‚ç‚¹
2. **å¤šå°ºåº¦å®è§‚**: å¼•å…¥å¤šç²’åº¦çš„å®è§‚èŠ‚ç‚¹å±‚æ¬¡
3. **è·¨åŸŸè¿ç§»**: å°†å®è§‚å›¾çŸ¥è¯†è¿ç§»åˆ°æ–°é¢†åŸŸ
4. **å¯è§£é‡Šæ€§**: åˆ†æžå®è§‚èŠ‚ç‚¹çš„è¯­ä¹‰å«ä¹‰

---

## é™„å½•: è¿è¡ŒæŒ‡å—

### çŽ¯å¢ƒé…ç½®

```bash
# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# ä¾èµ–åˆ—è¡¨
# python >= 3.8
# torch == 1.11.0+
# scikit-learn == 1.1.1
# pandas == 1.4.1
# numpy == 1.21.2
# tqdm == 4.63.0
```

### å¿«é€Ÿå¼€å§‹

1. ä¸‹è½½æ•°æ®é›†å¹¶æ”¾å…¥ `data/` ç›®å½•
2. æ‰“å¼€ `MacGNN_demo.ipynb`
3. è¿è¡Œæ‰€æœ‰å•å…ƒæ ¼

### è‡ªå®šä¹‰å®žéªŒ

```python
# ä¿®æ”¹é…ç½®
config['dataset_name'] = 'kuairec'  # åˆ‡æ¢æ•°æ®é›†
config['embed_dim'] = 64            # å¢žå¤§åµŒå…¥ç»´åº¦
config['tau'] = 0.6                 # è°ƒæ•´æ¸©åº¦ç³»æ•°

# è¿è¡Œå®žéªŒ
results = run_experiment(config)
```

---

> **æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2024  
> **å®žéªŒçŽ¯å¢ƒ**: Apple Silicon (MPS) / NVIDIA CUDA

